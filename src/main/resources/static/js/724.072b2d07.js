"use strict";(self["webpackChunkrealsocket"]=self["webpackChunkrealsocket"]||[]).push([[724],{2724:function(s,e,t){t.r(e),t.d(e,{default:function(){return b}});var o=function(){var s=this,e=s._self._c;return e("div",[s._v(" 방이름 : "+s._s(this.$route.params.roomName)),e("button",{on:{click:s.outChat}},[s._v("나가기")]),e("br"),s._v(" 참가자 : "),s._l(s.userList,(function(t,o){return e("span",{key:o},[s._v(" "+s._s(t)+" ")])})),e("hr"),e("input",{directives:[{name:"model",rawName:"v-model",value:s.message,expression:"message"}],domProps:{value:s.message},on:{input:function(e){e.target.composing||(s.message=e.target.value)}}}),e("button",{on:{click:s.submitMessage}},[s._v("전송")]),e("hr"),e("div",s._l(s.messageList,(function(t,o){return e("div",{key:o},[t.nickname?e("div",[s._v(s._s(t.nickname)+" :: "+s._s(t.message)+" / "+s._s(t.date.getHours())+"시 "+s._s(t.date.getMinutes())+"분 "+s._s(t.date.getSeconds())+"초")]):e("div",[s._v(s._s(t.message))])])})),0)],2)},r=[],i=(t(7658),t(4311)),a=t(3266),n=t.n(a),u=t(4029),m=t.n(u),c={data(){return{userList:[],message:"",messageList:[],routerFlag:!1}},created(){this.start()},methods:{start(){if(this.$store.state.stompClient)this.updateSubscribe();else{const s=new(m())("http://43.201.83.68:9998/realsocket/websocket");this.$store.state.stompClient=n().over(s),this.$store.state.stompClient.connect({},(()=>{console.log("야호 연결성공요"),this.updateSubscribe()}))}},subscribeCancel(){for(let s of this.$store.state.subscribeList)this.$store.state.stompClient.unsubscribe(s.id);this.$store.state.subscribeList=[]},updateSubscribe(){console.log(sessionStorage.getItem("roomNumber")),i.Z.post("http://43.201.83.68:9998/realsocket/findRoom",sessionStorage.getItem("roomNumber"),{headers:{"Content-Type":"text/plain"}}).then((({data:s})=>{this.userList=s.users,this.subscribeCancel(),console.log("data.roomNumber : ",s.roomNumber);const e=this.$store.state.stompClient.subscribe("/topic/message/"+s.roomNumber,(s=>{var e=JSON.parse(s.body);e.date=new Date(e.date),this.messageList.push(e)}));this.$store.state.subscribeList.push(e);const t=this.$store.state.stompClient.subscribe("/topic/notification/"+s.roomNumber,(s=>{console.log("****************************************"),console.log(JSON.parse(s.body));var e=JSON.parse(s.body),t=this.userList.filter((s=>!e.includes(s))),o=e.filter((s=>!this.userList.includes(s)));for(var r of t){console.log(r,"가 나갔어");var i={message:r+"가 나갔어요"};this.messageList.push(i)}for(var a of o){console.log(a,"가 들어왔어");var n={message:a+"가 들어왔어요"};this.messageList.push(n)}this.userList=e}));this.$store.state.subscribeList.push(t)}))},submitMessage(){const s={message:this.message,nickname:this.$route.params.userId};this.$store.state.stompClient.send("/socket/sendMessage/"+sessionStorage.getItem("roomNumber"),JSON.stringify(s),{}),this.message=""},async outing(){alert("나갈게요"),await i.Z.post("http://43.201.83.68:9998/realsocket/outChat",{roomNumber:sessionStorage.getItem("roomNumber"),userId:this.$route.params.userId}).then((()=>{this.$store.state.stompClient.send("/socket/notification/"+sessionStorage.getItem("roomNumber"))}))},outChat(){this.$router.push("/")}},async beforeRouteLeave(s,e,t){await this.outing(),t()}},l=c,h=t(1001),g=(0,h.Z)(l,o,r,!1,null,null,null),b=g.exports}}]);
//# sourceMappingURL=724.072b2d07.js.map